"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var _regeneratorRuntime=_interopDefault(require("@babel/runtime/regenerator")),_asyncToGenerator=_interopDefault(require("@babel/runtime/helpers/asyncToGenerator")),axios=_interopDefault(require("axios")),_slicedToArray=_interopDefault(require("@babel/runtime/helpers/slicedToArray")),puppeteer=_interopDefault(require("puppeteer")),TINDER_OAUTH_URL="https://www.facebook.com/v2.6/dialog/oauth?redirect_uri=fb464891386855067%3A%2F%2Fauthorize%2F&scope=user_birthday%2Cuser_photos%2Cuser_education_history%2Cemail%2Cuser_relationship_details%2Cuser_friends%2Cuser_work_history%2Cuser_likes&response_type=token%2Csigned_request&client_id=464891386855067&ret=login&fallback_redirect_uri=221e1158-f2e9-1452-1a05-8983f99f7d6e&ext=1556057433&hash=Aea6jWwMP_tDMQ9y",EMAIL_ID="#email",PASSWORD_ID="#pass",LOGIN_ID="#loginbutton",CONFIRM_SELECTOR='button[name="__CONFIRM__"]';function generateAccessToken(){return _generateAccessToken.apply(this,arguments)}function _generateAccessToken(){return(_generateAccessToken=_asyncToGenerator(_regeneratorRuntime.mark(function e(r){var t,n,a,s,o,i,u,c,_,p,l;return _regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.emailAddress,n=r.password,e.next=3,puppeteer.launch();case 3:return a=e.sent,e.next=6,a.newPage();case 6:return s=e.sent,e.next=9,s.goto(TINDER_OAUTH_URL);case 9:return e.next=11,s.click(EMAIL_ID);case 11:return e.next=13,s.keyboard.type(t);case 13:return e.next=15,s.click(PASSWORD_ID);case 15:return e.next=17,s.keyboard.type(n);case 17:return e.next=19,Promise.all([s.waitForNavigation(),s.click(LOGIN_ID)]);case 19:return e.next=21,s.waitForSelector(CONFIRM_SELECTOR);case 21:return e.next=23,Promise.all([s.waitForResponse(function(e){return e.url().endsWith("/dialog/oauth/confirm/")}),s.click(CONFIRM_SELECTOR)]);case 23:return o=e.sent,i=_slicedToArray(o,1),u=i[0],e.next=28,u.text();case 28:return c=e.sent,_="access_token=",p=c.indexOf(_)+_.length,l=c.indexOf("&",p),e.next=34,a.close();case 34:return e.abrupt("return",c.substring(p,l));case 35:case"end":return e.stop()}},e)}))).apply(this,arguments)}function generateToken(){return _generateToken.apply(this,arguments)}function _generateToken(){return(_generateToken=_asyncToGenerator(_regeneratorRuntime.mark(function e(r){var t,n,a,s;return _regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.facebookEmailAddress,n=r.facebookPassword,e.next=3,generateAccessToken({emailAddress:t,password:n});case 3:return a=e.sent,e.next=6,axios.post("https://api.gotinder.com/v2/auth/login/facebook",{token:a});case 6:return s=e.sent,e.abrupt("return",{apiToken:s.data.data.api_token,refreshToken:s.data.data.refresh_token});case 8:case"end":return e.stop()}},e)}))).apply(this,arguments)}function refreshCredentials(){return _refreshCredentials.apply(this,arguments)}function _refreshCredentials(){return(_refreshCredentials=_asyncToGenerator(_regeneratorRuntime.mark(function e(r){var t,n,a;return _regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.apiToken,n=r.refreshToken,e.next=3,axios.post("https://api.gotinder.com/v2/auth",{grant_type:"refresh_token",refresh_token:n},{headers:{"X-Auth-Token":t}});case 3:return a=e.sent,e.abrupt("return",{apiToken:a.data.data.api_token,refreshToken:a.data.data.refresh_token});case 5:case"end":return e.stop()}},e)}))).apply(this,arguments)}exports.generateToken=generateToken,exports.refreshCredentials=refreshCredentials;
