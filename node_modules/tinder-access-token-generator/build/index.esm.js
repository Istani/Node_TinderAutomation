import e from"@babel/runtime/regenerator";import r from"@babel/runtime/helpers/asyncToGenerator";import t from"axios";import n from"@babel/runtime/helpers/slicedToArray";import a from"puppeteer";var s="https://www.facebook.com/v2.6/dialog/oauth?redirect_uri=fb464891386855067%3A%2F%2Fauthorize%2F&scope=user_birthday%2Cuser_photos%2Cuser_education_history%2Cemail%2Cuser_relationship_details%2Cuser_friends%2Cuser_work_history%2Cuser_likes&response_type=token%2Csigned_request&client_id=464891386855067&ret=login&fallback_redirect_uri=221e1158-f2e9-1452-1a05-8983f99f7d6e&ext=1556057433&hash=Aea6jWwMP_tDMQ9y",o="#email",i="#pass",u="#loginbutton",c='button[name="__CONFIRM__"]';function p(){return f.apply(this,arguments)}function f(){return(f=r(e.mark(function r(t){var p,f,l,d,h,k,_,m,x,b,w;return e.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return p=t.emailAddress,f=t.password,e.next=3,a.launch();case 3:return l=e.sent,e.next=6,l.newPage();case 6:return d=e.sent,e.next=9,d.goto(s);case 9:return e.next=11,d.click(o);case 11:return e.next=13,d.keyboard.type(p);case 13:return e.next=15,d.click(i);case 15:return e.next=17,d.keyboard.type(f);case 17:return e.next=19,Promise.all([d.waitForNavigation(),d.click(u)]);case 19:return e.next=21,d.waitForSelector(c);case 21:return e.next=23,Promise.all([d.waitForResponse(function(e){return e.url().endsWith("/dialog/oauth/confirm/")}),d.click(c)]);case 23:return h=e.sent,k=n(h,1),_=k[0],e.next=28,_.text();case 28:return m=e.sent,x="access_token=",b=m.indexOf(x)+x.length,w=m.indexOf("&",b),e.next=34,l.close();case 34:return e.abrupt("return",m.substring(b,w));case 35:case"end":return e.stop()}},r)}))).apply(this,arguments)}function l(){return d.apply(this,arguments)}function d(){return(d=r(e.mark(function r(n){var a,s,o,i;return e.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.facebookEmailAddress,s=n.facebookPassword,e.next=3,p({emailAddress:a,password:s});case 3:return o=e.sent,e.next=6,t.post("https://api.gotinder.com/v2/auth/login/facebook",{token:o});case 6:return i=e.sent,e.abrupt("return",{apiToken:i.data.data.api_token,refreshToken:i.data.data.refresh_token});case 8:case"end":return e.stop()}},r)}))).apply(this,arguments)}function h(){return k.apply(this,arguments)}function k(){return(k=r(e.mark(function r(n){var a,s,o;return e.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.apiToken,s=n.refreshToken,e.next=3,t.post("https://api.gotinder.com/v2/auth",{grant_type:"refresh_token",refresh_token:s},{headers:{"X-Auth-Token":a}});case 3:return o=e.sent,e.abrupt("return",{apiToken:o.data.data.api_token,refreshToken:o.data.data.refresh_token});case 5:case"end":return e.stop()}},r)}))).apply(this,arguments)}export{l as generateToken,h as refreshCredentials};
